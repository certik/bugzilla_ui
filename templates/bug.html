{% extends "base.html" %}

{% block title %}
Issue {{ bug.bug_id }} - {{ bug.short_desc }}
{% endblock %}

{% block script %}
<script type="text/javascript">
function attach_file_click(event) {
    event.preventDefault();
    $("div.attachmentarea").show();
    $(event.target).hide();
}
$(document).ready(function() {
    $("#attachafile").click(attach_file_click);
});
</script>
{% endblock %}

{% block content %}
    <div id="content">

        {% include "header.html" %}

        <div id="issue" class="panel">
            <b>Issue <a href="http://hpfem.org/bugs/show_bug.cgi?id={{ bug.bug_id }}">{{ bug.bug_id }}</a>: {{ bug.short_desc }}</b>
            <span id="prevnext">
                {% if prev_bug %}
                    <a href="/bugs-ui/bug/{{ prev_bug }}/">&laquo; Prev</a>
                {% endif %}
                {% if next_bug %}
                    <a href="/bugs-ui/bug/{{ next_bug }}/">Next &raquo;</a>
                {% endif %}
            </span>
        </div>
        <div id="metadata">
            <table>
                <tr><td><b>Status:</b></td><td><a class="label" href="/bugs-ui/?status={{ bug.bug_status }}">{{ bug.bug_status|lower|capfirst }}</a></td></tr>
                <tr><td><b>Product:</b></td><td><a class="label" href="/bugs-ui/?product={{ bug.product.name }}">{{ bug.product.name }}</a></td></tr>
                <tr><td><b>Component:</b></td><td>{{ bug.component.name }}</td></tr>
                <tr><td><b>Platform:</b></td><td>{{ bug.rep_platform }}</td></tr>
                <tr><td><b>Priority:</b></td><td><a class="label" href="/bugs-ui/?priority={{ bug.priority }}">{{ bug.priority }}</a></td></tr>
                <tr><td>Bugzilla:</td><td><a href="http://hpfem.org/bugs/show_bug.cgi?id={{ bug.bug_id }}">{{ bug.bug_id }}</a></td></tr>
                <tr><td></td><td></td><tr>
                <tr><td></td><td></td><tr>
                {% for kw in keywords %}
                    <tr><td><a class="label" href="/bugs-ui/?keyword={{ kw.id }}">{{ kw.name }}</a></td><td></td><tr>
                {% endfor %}
            </table>
        </div>
        <div id="comments">
            <div class="comment">
                <div class="comment_head">
                    Reported by <a href="/bugs-ui/u/{{ comments_first.who.login_name }}/">{{ comments_first.who.realname }}</a>,
                    {{ comments_first.bug_when }}
                </div>
                <div class="comment_body">
                    <pre>{{ comments_first.thetext|urlize }}</pre>
                </div>
            </div>
            {% for comment in comments_other %}
            <div class="comment">
                <div class="comment_head">
                    Comment <a href="/bugs-ui/bug/{{ bug.bug_id }}/#{{ forloop.counter }}">{{ forloop.counter }}</a>
                    by <a href="/bugs-ui/u/{{ comment.who.login_name }}/">{{ comment.who.realname }}</a>,
                    {{ comment.bug_when }}

                    {% ifequal user.username comment.who.login_name %}
                        <a href="/bugs-ui/bug/{{ bug.bug_id }}/delete/{{ comment.comment_id }}">Delete comment</a>
                    {% endifequal %}
                </div>
                <div class="comment_body">
                    <pre>{{ comment.thetext|urlize }}</pre>
                </div>
            </div>
            {% endfor %}
            <div class="comment">
            {% if user.is_authenticated %}
                <div class="comment_head">
                    Add a comment
                </div>
                <div class="comment_body">
                    <form action="/bugs-ui/bug/{{ bug.bug_id }}/" method="GET">
                        {{ comment_form.comment_text }}<br/>
                        <div class="attachmentarea">
                            {{ comment_form.attachment }}
                        </div>
                        <a href="" id="attachafile">Attach a file</a><br/>
                        <br/>
                        <input type="submit" value="Post comment"/>
                    </form>
                </div>
            {% else %}
                <div class="comment_head">
                    <a href="/bugs-ui/login/?next={{ request_path }}">Login</a> to add a comment.
                </div>
            {% endif %}
            </div>
        </div>
        {% if attachments %}
        <div class="attachments">
            <b>Attachments:</b>
            <table class="attachments">
                <tr>
                    <th>File</th>
                    <th>Submitter</th>
                    <th>Date</th>
                </tr>

                {% for a in attachments %}
                <tr>
                    <td>{{ a.filename }} (view, <a href="/bugs-ui/attachment/{{ a.attach_id }}">download</a>)</td>
                    <td>{{ a.submitter.realname }}</td>
                    <td>{{ a.creation_ts }})</td>
                </tr>
                {% endfor %}
            </table>
        </div>
        {% endif %}
    </div>
{% endblock %}

